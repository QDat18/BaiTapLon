<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chi tiết MacBook - Anh Em Rọt Store</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css" />
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    :root {
      --primary: #000000;
      --secondary: #ff3a2d;
      --light: #f8f9fa;
      --dark: #212529;
      --gray: #6c757d;
      --accent: #0071e3;
    }

    body {
      background-color: #f5f5f7;
      color: var(--dark);
      font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
      overflow-x: hidden;
    }

    .product-detail-container {
      padding: 2rem 0;
    }

    .breadcrumb {
      background: transparent;
      padding: 0.5rem 0;
      margin-bottom: 1.5rem;
    }

    .breadcrumb-item a {
      color: var(--gray);
      text-decoration: none;
      transition: color 0.3s ease;
    }

    .breadcrumb-item a:hover {
      color: var(--accent);
    }

    .product-gallery {
      background: white;
      border-radius: 16px;
      padding: 1.5rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      position: relative;
    }

    .main-image-container {
      position: relative;
      overflow: hidden;
      border-radius: 12px;
      cursor: zoom-in;
      aspect-ratio: 4 / 3;
    }

    .main-image {
      width: 100%;
      height: 100%;
      object-fit: contain;
      transition: transform 0.3s ease, opacity 0.2s ease;
    }

    .main-image-container:hover .main-image {
      transform: scale(1.05);
    }

    .zoom-icon {
      position: absolute;
      bottom: 15px;
      right: 15px;
      background: rgba(0, 0, 0, 0.5);
      color: white;
      padding: 8px;
      border-radius: 50%;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .main-image-container:hover .zoom-icon {
      opacity: 1;
    }

    .thumbnail-container {
      display: flex;
      gap: 10px;
      margin-top: 1rem;
      overflow-x: auto;
      padding-bottom: 0.5rem;
    }

    .thumbnail {
      width: 80px;
      height: 60px;
      object-fit: cover;
      border-radius: 8px;
      cursor: pointer;
      border: 2px solid transparent;
      transition: border-color 0.3s ease, transform 0.2s ease;
    }

    .thumbnail.active {
      border-color: var(--accent);
      transform: scale(1.1);
    }

    .product-info {
      background: white;
      border-radius: 16px;
      padding: 2rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .product-badge {
      background: var(--secondary);
      color: white;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 0.9rem;
      font-weight: 600;
      display: inline-block;
      margin-bottom: 1rem;
    }

    .product-title {
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--dark);
      margin-bottom: 0.5rem;
    }

    .product-subtitle {
      font-size: 1rem;
      color: var(--gray);
      margin-bottom: 1.5rem;
    }

    .product-price {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--secondary);
      margin-right: 1rem;
    }

    .product-old-price {
      font-size: 1.1rem;
      color: var(--gray);
      text-decoration: line-through;
      margin-right: 1rem;
    }

    .product-discount {
      font-size: 1rem;
      color: #28a745;
      font-weight: 600;
    }

    .product-meta {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }

    .rating {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .stars i {
      color: #ffc107;
      font-size: 0.9rem;
    }

    .rating-count {
      color: var(--gray);
      font-size: 0.9rem;
    }

    .divider {
      width: 1px;
      height: 20px;
      background: #dee2e6;
    }

    .sold-count {
      color: var(--gray);
      font-size: 0.9rem;
    }

    .option-section {
      margin-bottom: 1.5rem;
    }

    .option-title {
      font-weight: 600;
      font-size: 1.1rem;
      margin-bottom: 0.75rem;
      color: var(--dark);
    }

    .variant-options {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .variant-option {
      padding: 8px 16px;
      border: 2px solid #dee2e6;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.3s ease;
    }

    .variant-option.active,
    .variant-option:hover {
      border-color: var(--accent);
      background: #f1f3f5;
    }

    .color-options .color-option {
      text-align: center;
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .color-options .color-option.active,
    .color-options .color-option:hover {
      background: #f1f3f5;
      border: 2px solid var(--accent);
    }

    .color-option-image {
      width: 100%;
      height: 80px;
      object-fit: contain;
      border-radius: 6px;
      margin-bottom: 0.5rem;
    }

    .color-name {
      font-size: 0.85rem;
      color: var(--dark);
    }

    .price-difference {
      color: var(--gray);
      font-size: 0.8rem;
    }

    .promotion-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .promotion-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.9rem;
      color: var(--dark);
    }

    .promotion-item i {
      color: #28a745;
    }

    .action-buttons {
      display: flex;
      gap: 1rem;
      margin-top: 1.5rem;
    }

    .btn-add-to-cart,
    .btn-buy-now {
      flex: 1;
      padding: 12px;
      border-radius: 8px;
      font-weight: 500;
      transition: all 0.3s ease;
      text-align: center;
    }

    .btn-add-to-cart {
      background: var(--primary);
      color: white;
      border: none;
    }

    .btn-add-to-cart:hover {
      background: var(--accent);
      transform: translateY(-2px);
    }

    .btn-buy-now {
      background: var(--secondary);
      color: white;
      border: none;
    }

    .btn-buy-now:hover {
      background: #e02b20;
      transform: translateY(-2px);
    }

    .product-tabs {
      margin-top: 3rem;
      background: white;
      border-radius: 16px;
      padding: 2rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .nav-tabs {
      border-bottom: 2px solid #dee2e6;
      margin-bottom: 1.5rem;
    }

    .nav-tabs .nav-link {
      color: var(--gray);
      font-weight: 500;
      padding: 0.75rem 1.5rem;
      border: none;
      transition: all 0.3s ease;
    }

    .nav-tabs .nav-link.active {
      color: var(--accent);
      border-bottom: 3px solid var(--accent);
    }

    .nav-tabs .nav-link:hover {
      color: var(--accent);
    }

    .specs-grid {
      display: grid;
      gap: 1.5rem;
    }

    .spec-group {
      padding: 1rem;
      border-radius: 8px;
      background: #f8f9fa;
    }

    .spec-group-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: var(--dark);
    }

    .spec-item {
      display: flex;
      justify-content: space-between;
      padding: 0.5rem 0;
      border-bottom: 1px solid #dee2e6;
    }

    .spec-label {
      font-weight: 500;
      color: var(--gray);
    }

    .spec-value {
      color: var(--dark);
      text-align: right;
    }

    .highlight-item {
      display: flex;
      gap: 1rem;
      padding: 1rem;
      border-radius: 8px;
      background: #f8f9fa;
      margin-bottom: 1rem;
    }

    .highlight-icon i {
      font-size: 1.5rem;
      color: var(--accent);
    }

    .highlight-content h5 {
      font-size: 1rem;
      font-weight: 600;
      color: var(--dark);
    }

    .highlight-content p {
      font-size: 0.9rem;
      color: var(--gray);
    }

    .warranty-card {
      padding: 1.5rem;
      border-radius: 8px;
      background: #f8f9fa;
    }

    .warranty-title {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: var(--dark);
    }

    .warranty-card ul {
      padding-left: 0;
      list-style: none;
    }

    .warranty-card li {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.9rem;
      color: var(--dark);
    }

    .swiper {
      padding-bottom: 2rem;
    }

    .swiper-slide .card {
      border: none;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      transition: transform 0.3s ease;
    }

    .swiper-slide .card:hover {
      transform: translateY(-5px);
    }

    .card-img-top {
      height: 150px;
      object-fit: contain;
      padding: 1rem;
      background: #f8f9fa;
    }

    .card-body {
      padding: 1.5rem;
    }

    .card-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--dark);
    }

    .fab {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--secondary);
      color: white;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .fab:hover {
      background: #e02b20;
      transform: scale(1.1);
    }

    .fab-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: #28a745;
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
    }

    .toast-notification {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 1050;
    }

    .image-modal .modal-content {
      background: transparent;
      border: none;
    }

    .image-modal img {
      max-height: 80vh;
      object-fit: contain;
    }

    @media (max-width: 768px) {
      .product-title {
        font-size: 1.5rem;
      }

      .product-price {
        font-size: 1.25rem;
      }

      .color-option-image {
        height: 60px;
      }

      .action-buttons {
        flex-direction: column;
      }

      .main-image-container {
        aspect-ratio: 1 / 1;
      }
    }
  </style>
</head>
<body>
  <!-- Product Detail -->
  <div class="container product-detail-container animate__animated animate__fadeIn">
    <div class="row">
      <div class="col-12">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="index.html"><i class="fas fa-home"></i></a></li>
            <li class="breadcrumb-item"><a href="macbook.html">MacBook</a></li>
            <li class="breadcrumb-item active" aria-current="page" id="productBreadcrumb"></li>
          </ol>
        </nav>
      </div>
    </div>
    
    <div class="row g-4">
      <!-- Product Gallery -->
      <div class="col-lg-6">
        <div class="product-gallery animate__animated animate__fadeIn" style="animation-delay: 0.1s">
          <div class="main-image-container">
            <img id="mainImage" src="" alt="" class="main-image">
            <div class="zoom-icon">
              <i class="fas fa-search-plus"></i>
            </div>
          </div>
          <div class="thumbnail-container" id="thumbnailContainer"></div>
        </div>
      </div>
      
      <!-- Product Info -->
      <div class="col-lg-6">
        <div class="product-info animate__animated animate__fadeIn" style="animation-delay: 0.2s">
          <div id="productBadge" class="product-badge d-none"><i class="fas fa-bolt"></i> Mới ra mắt</div>
          <h1 id="productTitle" class="product-title"></h1>
          <div id="productSubtitle" class="product-subtitle"></div>
          
          <div class="d-flex align-items-center mb-3">
            <div id="productOldPrice" class="product-old-price d-none"></div>
            <div id="productPrice" class="product-price"></div>
            <div id="productDiscount" class="product-discount d-none"></div>
          </div>
          
          <div class="product-meta">
            <div class="rating">
              <div class="stars">
                <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star-half-alt"></i>
              </div>
              <div class="rating-count">4.5 (128 đánh giá)</div>
            </div>
            <div class="divider"></div>
            <div id="soldCount" class="sold-count">Đã bán 1k+</div>
          </div>
          
          <div class="option-section">
            <div class="option-title"><i class="fas fa-palette"></i> Màu sắc</div>
            <div id="colorOptions" class="color-options row g-3"></div>
          </div>
          
          <div class="option-section" id="variantOptionsSection">
            <div class="option-title"><i class="fas fa-cogs"></i> Dung lượng & RAM</div>
            <div id="variantOptions" class="variant-options"></div>
          </div>
          
          <div class="option-section">
            <div class="option-title"><i class="fas fa-gift"></i> Khuyến mãi</div>
            <div class="promotion-list" id="promotionsList">
              <div class="promotion-item">
                <i class="fas fa-check-circle"></i>
                <span>Giảm thêm 5% khi mua cùng phụ kiện Mac</span>
              </div>
              <div class="promotion-item">
                <i class="fas fa-check-circle"></i>
                <span>Miễn phí vận chuyển toàn quốc</span>
              </div>
              <div class="promotion-item">
                <i class="fas fa-check-circle"></i>
                <span>Bảo hành 12 tháng chính hãng</span>
              </div>
            </div>
          </div>
          
          <div class="action-buttons">
            <button class="btn btn-add-to-cart">
              <i class="fas fa-cart-plus"></i> Thêm vào giỏ
            </button>
            <button class="btn btn-buy-now">
              <i class="fas fa-bolt"></i> Mua ngay
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Product Tabs -->
    <div class="product-tabs animate__animated animate__fadeInUp mt-5">
      <ul class="nav nav-tabs" id="productTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="specs-tab" data-bs-toggle="tab" data-bs-target="#specs" type="button" role="tab">
            <i class="fas fa-info-circle me-2"></i>Thông số kỹ thuật
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="highlights-tab" data-bs-toggle="tab" data-bs-target="#highlights" type="button" role="tab">
            <i class="fas fa-star me-2"></i>Nổi bật
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="warranty-tab" data-bs-toggle="tab" data-bs-target="#warranty" type="button" role="tab">
            <i class="fas fa-shield-alt me-2"></i>Bảo hành
          </button>
        </li>
      </ul>
      <div class="tab-content" id="productTabsContent">
        <div class="tab-pane fade show active" id="specs" role="tabpanel">
          <div class="specs-grid" id="productSpecs"></div>
        </div>
        <div class="tab-pane fade" id="highlights" role="tabpanel">
          <div class="row" id="productHighlights"></div>
        </div>
        <div class="tab-pane fade" id="warranty" role="tabpanel">
          <div class="warranty-card">
            <h4 class="warranty-title"><i class="fas fa-shield-alt"></i> Chính sách bảo hành</h4>
            <p>Chúng tôi cam kết bảo hành chính hãng 12 tháng cho tất cả MacBook. Đổi mới 30 ngày nếu có lỗi từ nhà sản xuất.</p>
            <ul class="mt-3">
              <li class="mb-2"><i class="fas fa-check-circle text-secondary me-2"></i> Bảo hành tại các trung tâm ủy quyền của Apple trên toàn quốc</li>
              <li class="mb-2"><i class="fas fa-check-circle text-secondary me-2"></i> Hỗ trợ 1 đổi 1 trong 30 ngày đầu tiên nếu phát sinh lỗi</li>
              <li class="mb-2"><i class="fas fa-check-circle text-secondary me-2"></i> Tư vấn kỹ thuật miễn phí trọn đời sản phẩm</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Product Suggestion -->
  <div class="container mt-5">
    <h4 class="mb-4">Có thể bạn cũng quan tâm</h4>
    <div class="swiper mySwiper">
      <div class="swiper-wrapper" id="recommendationSlider"></div>
      <div class="swiper-pagination"></div>
      <div class="swiper-button-prev"></div>
      <div class="swiper-button-next"></div>
    </div>
  </div>

  <!-- Floating Action Button -->
  <div class="fab animate__animated animate__fadeInUp" style="animation-delay: 0.3s">
    <i class="fas fa-shopping-cart"></i>
    <div class="fab-badge">3</div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Get product name from URL
      const urlParams = new URLSearchParams(window.location.search);
      const productName = decodeURIComponent(urlParams.get('product'));

      if (!productName) {
        window.location.href = 'macbook.html';
        return;
      }

      // Fetch product data
      fetchProductData(productName);

      // Zoom image functionality
      document.querySelector('.main-image-container')?.addEventListener('click', () => {
        const mainImage = document.getElementById('mainImage');
        showImageModal(mainImage.src, mainImage.alt);
      });

      // Add to cart and buy now buttons
      document.querySelector('.btn-add-to-cart')?.addEventListener('click', addToCart);
      document.querySelector('.btn-buy-now')?.addEventListener('click', buyNow);

      // Floating cart button
      document.querySelector('.fab')?.addEventListener('click', () => {
        window.location.href = 'cart.html';
      });
    });

    function fetchProductData(productName) {
      fetch('data/product.json')
        .then(res => {
          if (!res.ok) throw new Error('Không thể tải dữ liệu sản phẩm');
          return res.json();
        })
        .then(data => {
          let product;
          data.categories.forEach(category => {
            const found = category.products.find(p => p.name === productName);
            if (found) product = found;
          });

          if (!product) throw new Error('Không tìm thấy sản phẩm');

          const transformedProduct = {
            id: product.id,
            name: product.name,
            description: product.description || 'Không có mô tả',
            isNew: new Date(product.releaseDate) > new Date(Date.now() - 30 * 24 * 60 * 60 * 1000),
            price: Math.min(...product.variants.map(v => v.price)),
            originalPrice: product.variants[0].originalPrice || null,
            soldCount: Math.floor(Math.random() * 1000) + 500,
            rating: 4.5,
            reviewCount: 128,
            colors: [],
            variantOptions: product.variants.map(v => ({
              label: `${v.storage || 'Mặc định'} - ${v.ram || '8GB'} RAM`,
              price: v.price,
              originalPrice: v.originalPrice || null
            })),
            specs: {
              'Thông số chung': {
                'Màn hình': product.specs?.screen || 'Không xác định',
                'CPU': product.specs?.cpu || 'Không xác định',
                'RAM': product.specs?.ram || 'Không xác định',
                'Dung lượng lưu trữ': product.specs?.storage || 'Không xác định',
                'Hệ điều hành': product.specs?.os || 'macOS',
                'Ngày ra mắt': product.releaseDate
              }
            },
            highlights: product.specs?.map((spec, index) => ({
              title: Object.keys({screen: '', cpu: '', ram: '', storage: ''})[index] || `Điểm nổi bật ${index + 1}`,
              description: `Đặc điểm: ${spec}`,
              icon: ['laptop', 'microchip', 'memory', 'hdd'][index % 4] || 'star'
            })) || [],
            promotions: [
              'Giảm thêm 5% khi mua cùng phụ kiện Mac',
              'Miễn phí vận chuyển toàn quốc',
              'Bảo hành 12 tháng chính hãng'
            ]
          };

          product.variants.forEach(variant => {
            variant.colors.forEach(color => {
              if (!transformedProduct.colors.some(c => c.name === color)) {
                transformedProduct.colors.push({
                  name: color,
                  imageUrl: product.imageUrl,
                  thumbnails: [product.imageUrl]
                });
              }
            });
          });

          if (product.variants.length === 1 && !product.variants[0].storage && !product.variants[0].ram) {
            document.getElementById('variantOptionsSection').style.display = 'none';
          }

          displayProduct(transformedProduct);
          renderRecommendedProducts(product.id);
        })
        .catch(err => {
          console.error('Lỗi khi tải sản phẩm:', err);
          showErrorModal();
        });
    }

    function displayProduct(product) {
      document.title = `${product.name} | Anh Em Rọt Store`;
      document.getElementById('productTitle').textContent = product.name;
      document.getElementById('productBreadcrumb').textContent = product.name;
      document.getElementById('productSubtitle').textContent = product.description;

      document.getElementById('productPrice').textContent = `${product.price.toLocaleString('vi-VN')}₫`;
      if (product.originalPrice && product.originalPrice > product.price) {
        document.getElementById('productOldPrice').classList.remove('d-none');
        document.getElementById('productOldPrice').textContent = `${product.originalPrice.toLocaleString('vi-VN')}₫`;
        const discountPercent = Math.round((1 - product.price / product.originalPrice) * 100);
        document.getElementById('productDiscount').classList.remove('d-none');
        document.getElementById('productDiscount').textContent = `-${discountPercent}%`;
      }

      document.getElementById('soldCount').textContent = `Đã bán ${product.soldCount >= 1000 ? (product.soldCount / 1000).toFixed(1) + 'k' : product.soldCount}`;

      const mainImage = document.getElementById('mainImage');
      const thumbnailContainer = document.getElementById('thumbnailContainer');
      if (product.colors.length > 0) {
        const firstColor = product.colors[0];
        mainImage.src = firstColor.imageUrl;
        mainImage.alt = `${product.name} - ${firstColor.name}`;
        displayThumbnails(firstColor.thumbnails, product.name);
      } else {
        mainImage.src = product.imageUrl || '/assets/placeholder.jpg';
        mainImage.alt = product.name;
        displayThumbnails([product.imageUrl || '/assets/placeholder.jpg'], product.name);
      }

      const colorOptions = document.getElementById('colorOptions');
      colorOptions.innerHTML = '';
      product.colors.forEach((color, index) => {
        const col = document.createElement('div');
        col.className = 'col-6 col-sm-4 col-md-3';
        const colorOption = document.createElement('div');
        colorOption.className = `color-option ${index === 0 ? 'active' : ''}`;
        colorOption.innerHTML = `
          <img src="${color.imageUrl}" alt="${color.name}" class="color-option-image">
          <div class="color-name">${color.name}</div>
        `;
        colorOption.addEventListener('click', () => {
          document.querySelectorAll('.color-option').forEach(c => c.classList.remove('active'));
          colorOption.classList.add('active');
          mainImage.src = color.imageUrl;
          mainImage.alt = `${product.name} - ${color.name}`;
          displayThumbnails(color.thumbnails, product.name);
          mainImage.style.opacity = 0;
          setTimeout(() => { mainImage.style.opacity = 1; }, 200);
        });
        col.appendChild(colorOption);
        colorOptions.appendChild(col);
      });

      const variantOptions = document.getElementById('variantOptions');
      variantOptions.innerHTML = '';
      product.variantOptions.forEach((option, index) => {
        const variantOption = document.createElement('div');
        variantOption.className = `variant-option ${index === 0 ? 'active' : ''}`;
        variantOption.textContent = option.label;
        if (index > 0) {
          const priceDiff = option.price - product.variantOptions[0].price;
          if (priceDiff > 0) variantOption.innerHTML += ` <span class="price-difference">+${priceDiff.toLocaleString('vi-VN')}₫</span>`;
        }
        variantOption.addEventListener('click', () => {
          document.querySelectorAll('.variant-option').forEach(s => s.classList.remove('active'));
          variantOption.classList.add('active');
          document.getElementById('productPrice').textContent = `${option.price.toLocaleString('vi-VN')}₫`;
          if (option.originalPrice && option.originalPrice > option.price) {
            document.getElementById('productOldPrice').classList.remove('d-none');
            document.getElementById('productOldPrice').textContent = `${option.originalPrice.toLocaleString('vi-VN')}₫`;
            const discountPercent = Math.round((1 - option.price / option.originalPrice) * 100);
            document.getElementById('productDiscount').classList.remove('d-none');
            document.getElementById('productDiscount').textContent = `-${discountPercent}%`;
          } else {
            document.getElementById('productOldPrice').classList.add('d-none');
            document.getElementById('productDiscount').classList.add('d-none');
          }
        });
        variantOptions.appendChild(variantOption);
      });

      const productSpecs = document.getElementById('productSpecs');
      productSpecs.innerHTML = '';
      for (const [group, specs] of Object.entries(product.specs)) {
        const specGroup = document.createElement('div');
        specGroup.className = 'spec-group';
        specGroup.innerHTML = `<h5 class="spec-group-title">${group}</h5>`;
        for (const [key, value] of Object.entries(specs)) {
          const specItem = document.createElement('div');
          specItem.className = 'spec-item';
          specItem.innerHTML = `<div class="spec-label">${key}</div><div class="spec-value">${value}</div>`;
          specGroup.appendChild(specItem);
        }
        productSpecs.appendChild(specGroup);
      }

      const productHighlights = document.getElementById('productHighlights');
      productHighlights.innerHTML = '';
      product.highlights.forEach(highlight => {
        const col = document.createElement('div');
        col.className = 'col-md-6';
        const highlightItem = document.createElement('div');
        highlightItem.className = 'highlight-item';
        highlightItem.innerHTML = `
          <div class="highlight-icon"><i class="fas fa-${highlight.icon}"></i></div>
          <div class="highlight-content"><h5>${highlight.title}</h5><p>${highlight.description}</p></div>
        `;
        col.appendChild(highlightItem);
        productHighlights.appendChild(col);
      });

      if (product.isNew) document.getElementById('productBadge').classList.remove('d-none');
    }

    function renderRecommendedProducts(currentProductId) {
      fetch('data/product.json')
        .then(res => {
          if (!res.ok) throw new Error('Không thể tải dữ liệu gợi ý');
          return res.json();
        })
        .then(data => {
          const slider = document.getElementById('recommendationSlider');
          slider.innerHTML = '';

          const macbookCategory = data.categories.find(cat => cat.name === 'MacBook');
          if (macbookCategory) {
            macbookCategory.products.filter(p => p.id !== currentProductId).slice(0, 4).forEach(product => {
              const slide = document.createElement('div');
              slide.className = 'swiper-slide';
              slide.innerHTML = `
                <div class="card h-100">
                  <img src="${product.imageUrl}" class="card-img-top" alt="${product.name}">
                  <div class="card-body">
                    <h6 class="card-title">${product.name}</h6>
                    <p class="card-text text-danger">${Math.min(...product.variants.map(v => v.price)).toLocaleString('vi-VN')}₫</p>
                    <a href="macbook_detail.html?product=${encodeURIComponent(product.name)}" class="btn btn-outline-primary btn-sm">Xem chi tiết</a>
                  </div>
                </div>
              `;
              slider.appendChild(slide);
            });

            new Swiper(".mySwiper", {
              slidesPerView: 2,
              spaceBetween: 20,
              navigation: {
                nextEl: ".swiper-button-next",
                prevEl: ".swiper-button-prev",
              },
              pagination: {
                el: ".swiper-pagination",
                clickable: true,
              },
              breakpoints: {
                768: { slidesPerView: 3 },
                992: { slidesPerView: 4 },
              }
            });
          } else {
            slider.innerHTML = `
              <div class="col-12 text-center py-5">
                <i class="fas fa-exclamation-triangle fa-3x mb-3 text-danger"></i>
                <p class="text-danger">Không thể tải sản phẩm gợi ý</p>
              </div>
            `;
          }
        })
        .catch(err => console.error("Lỗi khi load sản phẩm gợi ý:", err));
    }

    function displayThumbnails(thumbnails, productName) {
      const thumbnailContainer = document.getElementById('thumbnailContainer');
      thumbnailContainer.innerHTML = '';
      thumbnails.forEach((img, index) => {
        const thumbnail = document.createElement('img');
        thumbnail.src = img;
        thumbnail.alt = `${productName} - Ảnh ${index + 1}`;
        thumbnail.className = 'thumbnail' + (index === 0 ? ' active' : '');
        thumbnail.addEventListener('click', () => {
          document.getElementById('mainImage').src = img;
          document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
          thumbnail.classList.add('active');
          document.getElementById('mainImage').style.opacity = 0;
          setTimeout(() => { document.getElementById('mainImage').style.opacity = 1; }, 200);
        });
        thumbnailContainer.appendChild(thumbnail);
      });
    }

    function showImageModal(imageSrc, imageAlt) {
      const modalHTML = `
        <div class="modal fade image-modal" id="imageModal" tabindex="-1" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-body text-center p-0">
                <img src="${imageSrc}" alt="${imageAlt}" class="img-fluid">
              </div>
            </div>
          </div>
        </div>
      `;
      document.body.insertAdjacentHTML('beforeend', modalHTML);
      const modal = new bootstrap.Modal(document.getElementById('imageModal'));
      modal.show();
      document.getElementById('imageModal').addEventListener('hidden.bs.modal', () => modal._element.remove());
    }

    function addToCart() {
      const btn = document.querySelector('.btn-add-to-cart');
      btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Đang thêm...';
      btn.disabled = true;

      const selectedColor = document.querySelector('.color-option.active .color-name')?.textContent || 'Mặc định';
      const selectedVariant = document.querySelector('.variant-option.active')?.textContent.split(' ')[0] || 'Mặc định';
      const productName = document.getElementById('productTitle').textContent;
      const productPrice = document.getElementById('productPrice').textContent.replace('₫', '');
      const productImage = document.getElementById('mainImage').src;

      let cart = JSON.parse(localStorage.getItem('cart')) || [];
      const existingItem = cart.find(item => item.name === productName && item.color === selectedColor && item.variant === selectedVariant);

      if (existingItem) existingItem.quantity += 1;
      else cart.push({ name: productName, color: selectedColor, variant: selectedVariant, price: productPrice, image: productImage, quantity: 1 });

      localStorage.setItem('cart', JSON.stringify(cart));

      setTimeout(() => {
        showToast('Sản phẩm đã được thêm vào giỏ hàng', 'success');
        btn.innerHTML = '<i class="fas fa-cart-plus"></i> Thêm vào giỏ';
        btn.disabled = false;
      }, 1000);
    }

    function buyNow() {
      const selectedColor = document.querySelector('.color-option.active .color-name')?.textContent || 'Mặc định';
      const selectedVariant = document.querySelector('.variant-option.active')?.textContent.split(' ')[0] || 'Mặc định';
      const productName = document.getElementById('productTitle').textContent;
      const productPrice = document.getElementById('productPrice').textContent.replace('₫', '');
      const productImage = document.getElementById('mainImage').src;

      let cart = JSON.parse(localStorage.getItem('cart')) || [];
      const existingItem = cart.find(item => item.name === productName && item.color === selectedColor && item.variant === selectedVariant);

      if (existingItem) existingItem.quantity += 1;
      else cart.push({ name: productName, color: selectedColor, variant: selectedVariant, price: productPrice, image: productImage, quantity: 1 });

      localStorage.setItem('cart', JSON.stringify(cart));
      localStorage.setItem('checkoutCart', JSON.stringify(cart));
      window.location.href = 'checkout.html';
    }

    function showToast(message, type = 'success') {
      const toastHTML = `
        <div class="toast-notification">
          <div class="toast show align-items-center text-white bg-${type === 'success' ? 'success' : 'danger'} border-0" role="alert">
            <div class="d-flex">
              <div class="toast-body">${message}</div>
              <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
            </div>
          </div>
        </div>
      `;
      document.body.insertAdjacentHTML('beforeend', toastHTML);
      setTimeout(() => {
        const toast = document.querySelector('.toast-notification .toast');
        if (toast) {
          toast.classList.remove('show');
          setTimeout(() => document.querySelector('.toast-notification')?.remove(), 300);
        }
      }, 3000);
    }

    function showErrorModal() {
      const modalHTML = `
        <div class="modal fade" id="errorModal" tabindex="-1" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header border-0">
                <h5 class="modal-title text-danger"><i class="fas fa-exclamation-triangle me-2"></i>Lỗi</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                <p>Không thể tải thông tin sản phẩm. Vui lòng thử lại sau.</p>
              </div>
              <div class="modal-footer border-0">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                <button type="button" class="btn btn-primary" onclick="window.location.reload()">
                  <i class="fas fa-sync-alt me-2"></i>Tải lại
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
      document.body.insertAdjacentHTML('beforeend', modalHTML);
      const modal = new bootstrap.Modal(document.getElementById('errorModal'));
      modal.show();
      document.getElementById('errorModal').addEventListener('hidden.bs.modal', () => window.location.href = 'macbook.html');
    }
  </script>
</body>
</html>